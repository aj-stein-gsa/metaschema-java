<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractGroupedNamedModelInstanceTypeInfo.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Metaschema Java Data Binding and Code Generation</a> &gt; <a href="index.source.html" class="el_package">gov.nist.secauto.metaschema.databind.codegen.typeinfo</a> &gt; <span class="el_source">AbstractGroupedNamedModelInstanceTypeInfo.java</span></div><h1>AbstractGroupedNamedModelInstanceTypeInfo.java</h1><pre class="source lang-java linenums">/*
 * SPDX-FileCopyrightText: none
 * SPDX-License-Identifier: CC0-1.0
 */

package gov.nist.secauto.metaschema.databind.codegen.typeinfo;

import com.squareup.javapoet.AnnotationSpec;
import com.squareup.javapoet.ClassName;
import com.squareup.javapoet.TypeSpec;

import gov.nist.secauto.metaschema.core.model.IModelDefinition;
import gov.nist.secauto.metaschema.core.model.INamedModelInstanceGrouped;
import gov.nist.secauto.metaschema.core.util.ObjectUtils;

import org.apache.commons.lang3.StringUtils;

import java.lang.annotation.Annotation;
import java.util.LinkedHashSet;
import java.util.Set;

import javax.lang.model.element.Modifier;

import edu.umd.cs.findbugs.annotations.NonNull;

public abstract class AbstractGroupedNamedModelInstanceTypeInfo&lt;I extends INamedModelInstanceGrouped&gt;
    implements IGroupedNamedModelInstanceTypeInfo {
  @NonNull
  private final I instance;
  @NonNull
  private final IChoiceGroupTypeInfo parentTypeInfo;

  protected AbstractGroupedNamedModelInstanceTypeInfo(
      @NonNull I instance,
<span class="fc" id="L35">      @NonNull IChoiceGroupTypeInfo parentTypeInfo) {</span>
<span class="fc" id="L36">    this.instance = instance;</span>
<span class="fc" id="L37">    this.parentTypeInfo = parentTypeInfo;</span>
<span class="fc" id="L38">  }</span>

  protected abstract Class&lt;? extends Annotation&gt; getBindingAnnotation();

  protected abstract void applyInstanceAnnotation(
      @NonNull AnnotationSpec.Builder instanceAnnotation,
      @NonNull AnnotationSpec.Builder choiceGroupAnnotation);

  @NonNull
  protected I getInstance() {
<span class="fc" id="L48">    return instance;</span>
  }

  protected IChoiceGroupTypeInfo getChoiceGroupTypeInfo() {
<span class="fc" id="L52">    return parentTypeInfo;</span>
  }

  @Override
  public Set&lt;IModelDefinition&gt; generateMemberAnnotation(
      @NonNull AnnotationSpec.Builder choiceGroupAnnotation,
      @NonNull TypeSpec.Builder typeBuilder,
      boolean requireExtension) {

<span class="fc" id="L61">    AnnotationSpec.Builder memberAnnotation = ObjectUtils.notNull(AnnotationSpec.builder(getBindingAnnotation()));</span>

<span class="fc" id="L63">    TypeInfoUtils.buildCommonBindingAnnotationValues(getInstance(), memberAnnotation);</span>

<span class="fc" id="L65">    Set&lt;IModelDefinition&gt; retval = new LinkedHashSet&lt;&gt;();</span>

<span class="fc" id="L67">    I instance = getInstance();</span>
<span class="fc" id="L68">    IModelDefinition definition = getInstance().getDefinition();</span>

<span class="fc" id="L70">    IChoiceGroupTypeInfo choiceGroupTypeInfo = getChoiceGroupTypeInfo();</span>
<span class="fc" id="L71">    ITypeResolver typeResolver = choiceGroupTypeInfo.getParentTypeInfo().getTypeResolver();</span>

    ClassName itemTypeName;
<span class="fc bfc" id="L74" title="All 2 branches covered.">    if (definition.isInline()) {</span>
      // these definitions will be generated as standalone child classes
<span class="fc" id="L76">      itemTypeName = typeResolver.getClassName(definition);</span>
<span class="fc" id="L77">      retval.add(definition);</span>
<span class="pc bpc" id="L78" title="1 of 2 branches missed.">    } else if (requireExtension) {</span>
      // these definitions will be generated as an extension of a global class
<span class="nc" id="L80">      ClassName extendedClassName = typeResolver.getClassName(definition);</span>
<span class="nc" id="L81">      itemTypeName = typeResolver.getSubclassName(</span>
<span class="nc" id="L82">          choiceGroupTypeInfo.getParentTypeInfo().getClassName(),</span>
<span class="nc" id="L83">          ObjectUtils.notNull(StringUtils.capitalize(instance.getEffectiveDisciminatorValue())),</span>
          definition);

<span class="nc" id="L86">      TypeSpec.Builder subClass = TypeSpec.classBuilder(itemTypeName);</span>
<span class="nc" id="L87">      subClass.superclass(extendedClassName);</span>
<span class="nc" id="L88">      subClass.addModifiers(Modifier.PUBLIC, Modifier.STATIC); // , Modifier.FINAL);</span>
      // subClass.addField(
      // FieldSpec.builder(String.class, &quot;DISCRIMINATOR&quot;, Modifier.PUBLIC,
      // Modifier.STATIC, Modifier.FINAL)
      // .initializer(&quot;\&quot;&quot; + instance.getEffectiveDisciminatorValue() + &quot;\&quot;&quot;)
      // .build());
<span class="nc" id="L94">      typeBuilder.addType(subClass.build());</span>
<span class="nc" id="L95">    } else {</span>
      // reference the global class
<span class="fc" id="L97">      itemTypeName = typeResolver.getClassName(definition);</span>
    }

<span class="fc" id="L100">    memberAnnotation.addMember(&quot;binding&quot;, &quot;$T.class&quot;, itemTypeName);</span>

<span class="fc" id="L102">    applyInstanceAnnotation(memberAnnotation, choiceGroupAnnotation);</span>

<span class="fc" id="L104">    return retval;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>